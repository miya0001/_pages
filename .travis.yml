sudo: false
language: php
notifications:
  email:
    on_success: never
    on_failure: change
cache:
- composer
- "$HOME/.composer/cache"
php:
- 7.0
env:
- WP_VERSION=latest WP_MULTISITE=0
- WP_VERSION=nightly WP_MULTISITE=0
before_script:
- bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
- composer install
script:
- vendor/bin/phpunit
after_success:
- sed -i -e "s/nightly/${TRAVIS_TAG}/" _pages.php
- curl https://raw.githubusercontent.com/miya0001/auto-build/master/auto-build.sh | bash

deploy:
  provider: releases
  api_key:
    secure: r68k/l7en/3gzwoHySAwjV8tv47zydCBwYb0TkriBkDuwM7Fvgk+Hz/xPztuOWYY8t3u0sRbY4F6HqjFV8ozEWa0BGW51k8ZhblQ9HVcfyUZ0b/+2QU4bfNrP0CmREWgO/pUKK3yjd0vIVkdH6Otb/Ad5GyPdtpC8YlhhyqfmWnELCWM3zVPCIpe0wn3SryeW3dtfuKRAmjnrIDCxypGkizGWgsUGtbX2G/iUQFGdRzW+XdrVTqxMQhAHFvQw84dOvxKzbxnjHWprRPbFVoyhA17F/S63zO9EhxJMSn4bh7ZNwp32JFzXrStob+M4Hwd/FvxRQhqrD0LSKGvO3gk6wFttC8ljznaf2tRcTu/g9m396BO+EMq5kOXRuxeLpDxdAhkiHnSWr1/qNYpp/s+3aeoUF9b607nqCJa6cPvjhRFlo9d83cvcihRXMdZo7sxlLZ/h9mzzoPrW0JOkYkpa31E7mVRIXLDrU7l7IyXeNFTeSSPf0uuX3wZzHe437toyO6V3h/LDyFXM7bSPzd8ny3fD6N3uSuUj/f22oVB1123Sy6RwKiSwXs0XrcD0JVfoqmO16iLb34X3qZ7KHn8wh/cC3t11oa1NzJaTyazog7zpn4f/egx3ZJRvWFxW+j3la0HESsEOx6Dmbig9gGE5YQWmFHoIlyodsIBC04xQd4=
  file: miya-child-pages-shortcode.zip
  on:
    tags: true
    repo: miya0001/_pages
